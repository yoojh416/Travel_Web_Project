<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.springframework.org/security/tags">
<head>
    <link rel="stylesheet" th:href="@{/css/button.css}"/>
    <link rel="stylesheet" th:href="@{/css/file-upload.css}"/>
    <meta charset="UTF-8"/>
    <title>ì˜ˆì•½ í™•ì¸ í˜ì´ì§€</title>
    <link th:rel="stylesheet" th:href="@{webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} "/>
    <!--script for i'mport-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="https://service.iamport.kr/js/iamport.payment-1.1.5.js"></script>

</head>
<body>


<div class="upload-container">
    <input type="hidden" name='userName' th:value="${member.username}">
    <input type="hidden" name='name' th:value="${member.name}">
    <input type="hidden" name='address' th:value="${member.address}">
    <div class="upload-header" style="text-align:center;">
        <th:block sec:authorize="isAuthenticated()">
            <h2>ğŸŠ<span sec:authentication="principal.username"></span> ë‹˜, ì—¬í–‰ ë‚´ìš©ì„ í™•ì¸í•´ë³´ì„¸ìš” ğŸŠ</h2>
        </th:block>
    </div>

    <div class="upload-content">
        <div class="form-group row">
            <input type="hidden" th:value="${product.proTitle}" class="proTitle"/>
            <h3 class="mt-5">ãƒ»ì£¼ë¬¸ ë²ˆí˜¸: <strong name="orderId" th:text="${order.orderId}"></strong></h3>
            <input type="hidden" name='orderId' th:value="${order.orderId}">
            <h3 class="mt-5">ãƒ»ê²°ì œ ê¸ˆì•¡: <strong th:name="orderPrice" th:text="${order.orderPrice}" class="orderPrice"></strong>ì›</h3>
            <h3 class="mt-5">ãƒ»ì¸ì› ìˆ˜: <strong th:name="orderQty" th:text="${order.orderQty}" class="orderQty"></strong>ëª…</h3>
            <h3 class="mt-5">ãƒ»ì´ ê¸ˆì•¡: <strong th:name="totalPrice" th:text="${totalPrice}"
                                            th:value="${totalPrice}" class="totalPrice"></strong>ì›</h3>
            <input type="hidden" name='totalPrice' th:value="${totalPrice}">
            <hr/>

            <h3 class="mt-5">ğŸ›« ì—¬í–‰ ì‹œì‘ì¼: <strong th:name="dateIn"
                                                th:text="${order.dateIn}"></strong></h3>
            <h3 class="mt-5">ğŸ›¬ ì—¬í–‰ ë§ˆì§€ë§‰ì¼: <strong th:name="dateOut"
                                                 th:text="${order.dateOut}"></strong></h3>
        </div>
        <div style="text-align:right;">
            <button class="button" type="button" id="check_module" style="font-size: 13px; margin:0px;">ê²°ì œí•˜ê¸°(í…ŒìŠ¤íŠ¸)</button>
            <a th:href="@{/order/cancel/{orderId}(orderId= ${order.orderId})}"
               class="button" style="font-size: 13px; text-decoration:none;" >ì—¬í–‰ ì·¨ì†Œí•˜ê¸°</a>
        </div>
    </div>

</div>
<script>
    $(document).ready(function(){
        $("#check_module").click(function(){
            var IMP = window.IMP;
            var orderId = $("input[name='orderId']").val();

            IMP.init("imp92101402");

            IMP.request_pay({
                pg: "html5_inicis",
                pay_method: "card",
                merchant_uid: 'Order_'+new Date().getTime(),
                amount: $("input[name='totalPrice']").val(),
                name: $(".proTitle").val(),
                buyer_email: $("input[name='userName']").val(),
                buyer_name: $("input[name='name']").val(),
                buyer_addr: $("input[name='address']").val(),
            }, function(rsp){
                console.log(rsp);
                if(rsp.success){
                    var msg="ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
                    msg += "ê³ ìœ ID: "+rsp.imp_uid;
                    msg += "ìƒì  ê±°ë˜ID: "+rsp.merchant_uid;
                    msg += "ê²°ì œ ê¸ˆì•¡: "+rsp.paid_amount;
                    msg += "ì¹´ë“œ ìŠ¹ì¸ë²ˆí˜¸: "+rsp.apply_num;
                    location.href="/order/confirmation/"+orderId;

                } else{
                    var msg = 'ê²°ì œì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.';
                    msg += 'ì—ëŸ¬ë‚´ìš©: '+rsp.error_msg;
                }
                alert(msg);
            });
        });
    });
</script>
</body>
</html>